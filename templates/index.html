{% extends "base.html" %}
{% block title %}一覧{% endblock %}
{% block content %}
<section class="section">
    <h2>Todo一覧</h2>
    <div class="toolbar">
        <a href="{{ url_for('new_get') }}" class="btn btn-primary">新規作成</a>
        <div class="filters">
            <span class="filter-label">表示:</span>
            <a href="{{ url_for('index', sort=sort, status='all') }}"
               class="btn btn-sm {{ 'btn-active' if status != 'open' }}">すべて</a>
            <a href="{{ url_for('index', sort=sort, status='open') }}"
               class="btn btn-sm {{ 'btn-active' if status == 'open' }}">未完了のみ</a>
        </div>
        <div class="filters">
            <span class="filter-label">並び替え:</span>
            <a href="{{ url_for('index', status=status) }}"
               class="btn btn-sm {{ 'btn-active' if not sort }}">デフォルト</a>
            <a href="{{ url_for('index', sort='priority', status=status) }}"
               class="btn btn-sm {{ 'btn-active' if sort == 'priority' }}">重要度</a>
            <a href="{{ url_for('index', sort='due', status=status) }}"
               class="btn btn-sm {{ 'btn-active' if sort == 'due' }}">期日</a>
            <a href="{{ url_for('index', sort='updated', status=status) }}"
               class="btn btn-sm {{ 'btn-active' if sort == 'updated' }}">更新日</a>
        </div>
    </div>
    {% if todos %}
    <table class="todo-table">
        <thead>
            <tr>
                <th class="col-status">状態</th>
                <th class="col-priority">重要度</th>
                <th>タイトル</th>
                <th class="col-desc">内容</th>
                <th class="col-date">期日</th>
                <th class="col-actions">操作</th>
            </tr>
        </thead>
        <tbody>
            {% for todo in todos %}
            <tr class="{{ 'row-done' if todo.status == 'done' }}">
                <td>
                    <form method="post" action="{{ url_for('toggle_todo', id=todo.id) }}" class="inline-form">
                        <button type="submit" class="btn-toggle"
                                title="{{ '未完了に戻す' if todo.status == 'done' else '完了にする' }}">
                            {{ '✅' if todo.status == 'done' else '⬜' }}
                        </button>
                    </form>
                </td>
                <td>
                    <span class="badge badge-{{ (todo.priority or 'Medium')|lower }}">
                        {{ (todo.priority or 'Medium') | priority_ja }}
                    </span>
                </td>
                <td class="{{ 'text-done' if todo.status == 'done' }}">{{ todo.title }}</td>
                <td class="{{ 'text-done' if todo.status == 'done' }}">{{ todo.description or '-' }}</td>
                <td>{{ todo.due_at | format_date }}</td>
                <td>
                    <a href="{{ url_for('edit_get', id=todo.id) }}" class="btn btn-sm">編集</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="empty">Todoがありません。新規作成から登録してください。</p>
    {% endif %}
</section>
{% endblock %}
